# VPN

VPN(Virtual Private Network) 技术是指采用隧道技术以及加密、身份认证等方法，在公众网络上构建专用网络的技术，数据通过安全的 “加密管道” 在公众网络中传播。

VPN 根据使用者的身份和权限，直接将使用者接入他所应该接触的信息中。

虚拟专用网 (VPN) 是通过一个互联网建立一个临时的、安全的连接，是一条穿过公用网络到企业网的安全、稳定的通信隧道。

他通过对数据包的加密和数据包目标地址的转换实现远程访问，简单的说VPN的核心就是利用公共网络建立虚拟私用网。

用户使用了选择的VPN软件之后，VPN客户端将自动加密通过网络连接发送的任何数据。在任何数据通过网络连接之前，它将首先通过VPN。然后，VPN将加密通信并将其传递下去。用户最终使用的任何在线门户都将看到传输的数据来自VPN服务器，而不是来自家庭（或咖啡店）网络。

用户使用VPN时，通过互联网传输的任何数据都会直接从ISP传输到VPN服务器，然后VPN会为用户连接到互联网。

VPN 只是一个通用术语，指的是“你的数据包将被加密，然后通过另一台服务器去发送“。VPN 可以使用一系列不同的协议（OpenVPN、PPTP、SSTP、IPsec 等）以不同的方式来实现。

VPN的工作模式

隧道模式：将整个私有IP包全部加密，并重新封装新的IP包头！ 


按协议进行分类有

1. PPTP 工作在OSI的第二层
2. L2TP 第二层
3. IPSec 第三层

按应用分类有

1. 远程访问虚拟专用网（Access VPN
2. 企业内部虚拟专用网（Intranet VPN）
3. 企业拓展虚拟专用网（Extranet VPN）


目前 VPN 产品中主要分 IPSec VPN 和 SSL VPN 两大类

1. IPSec VPN 是指采用 IPSec 安全技术标准的 VPN 设备
2. SSL VPN 指采用 SSL 协议来加密 IP 数据链路实现 远程接入 的一种新型 VPN 技术。 

应用场景

- 支持远程访问内部网络的应用
- 访问受地理限制的内容
- 保护数据

在没有言论自由的国家中绕过互联网审查；绕过Netflix等流媒体服务的基于地理位置的限制；在使用对等网络进行种子下载时确保隐私；对本地网络主持人（例如大学校园里的主持人）隐藏互联网活动；或在使用过时的应用程序或操作系统时安全地在公共Wi-Fi上传输用户登录凭据。


类型一、远程访问VPN

场景：出差员工与公司建立VPN隧道 

类型二、点到点VPN

场景：两家分公司/两个实体楼宇之间的VPN隧道

代表技术：IPsecVPN、GRE VPN、MPLS VPN

## 加密技术

2.1 对称加密算法

算法：说白了就是数学公式！如：x+5=y

x就是明文数据

y是加密之后的数据（密文）

5是密钥

对称加密算法：加密和解密使用同一个密钥（对称密钥）！

常见的对称加密算法：DES、3DES、AES

对称密钥：通信双方协商而成，协商过程是明文传输，容易被窃取！

对称加密算法的致命缺点：对称密钥容易丢失！

对称加密算法的优点：加密速度快！

2.2 非对称加密算法

非对称加密算法：双方加密和解密用的不是同一把钥匙！

密钥：需要2把钥匙：公钥和私钥

公钥+私钥如何产生的？不是双方协商而成，而是各自独立生成！一般都是成对生成！

一对公钥和私钥的关系：公钥和私钥互为加解密关系！公钥加密，私钥解密！私钥加密，公钥解密！

公钥公开，私钥不公开！

常见的非对称加密算法：RSA、DH

公钥和私钥不能互推！

机密性：使用对方的公钥加密！

数字签名/身份验证：用自己的私钥加密实现签名！

非对称加密算法优点：安全！

非对称加密算法缺点：速度慢，效率慢！对称+非对称结合：使用非对称加密算法来加密对称算法使用的对称密钥！

IPsecVPN就采用了这个过程！！！！

IPsecVPN采用的非对称加密算法是DH 

缺点

- 网速慢


安全问题

- 传输过程安全
- 用户身份验证
- 客户端电脑的安全性
- 完成访问后，客户端需要清除客户端电脑的缓存
- 服务端管理和日志跟踪
- 

## IPsec

它是一个 IETF 标准，例如可以在文档 RFC 6071 等中查到

它在 Linux 内核中被实现了

它有 2 个部分

1. 用户空间部分：负责密钥的交换，使用名为 IKE （ 网络密钥传输(internet key exchange)）的协议。
2. 内核空间部分：负责数据包的实际加密工作。一旦使用 IKE 生成了一个密钥，IPsec 的用户空间部分便会告诉内核使用哪个密钥来进行加密。然后内核便会使用该密钥来加密数据包！


当你打开一个 VPN 连接的时候，你需要与 VPN 服务器通信，并且和它协商使用一个密钥来进行加密。


建立IPSec VPN连接需要3个步骤

1. 定义流量触发IPSec

2. 建立管理连接

3. 建立数据连接

定义流量触发IPSec ：北京内部：192.168.1.0/24 上海分公司内部：172.16.1.0/24

192.168.1.0/24 --- 172.16.1.0/24

阶段一：管理连接

双方使用非对称加密算法，安全的同步对称算法的对称密钥！

阶段二：数据连接

使用阶段一留下来的对称密钥，使用对称加密算法+hash算法来传输实际的用户数据！ 


[IPsec](https://zhuanlan.zhihu.com/p/42167354)

## 可能用到的资料

[远程桌面、VPN登入、RADIUS安全服务器](https://zhuanlan.zhihu.com/p/141112470)

[手把手教你玩MPLS VPN如何配置](https://zhuanlan.zhihu.com/p/136214715)

[什么是二层vpn技术?](https://zhuanlan.zhihu.com/p/96620240)

[常见的VPN术语](https://zhuanlan.zhihu.com/p/113919857)

[常见的VPN术语2](https://zhuanlan.zhihu.com/p/115836666)

[在IPSec VPN里配置QoS的坑](https://zhuanlan.zhihu.com/p/114538749)

# 防火墙

[Linux防火墙和VPN](https://zhuanlan.zhihu.com/p/141859728)

[Linux 防火墙入门](https://zhuanlan.zhihu.com/p/133657723)

## iptables防火墙
